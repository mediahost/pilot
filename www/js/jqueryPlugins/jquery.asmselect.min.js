(function(a){a.fn.asmSelect=function(b){var c={listType:"ol",sortable:false,highlight:false,animate:false,addItemTarget:"bottom",hideWhenAdded:false,debugMode:false,removeLabel:"remove",highlightAddedLabel:"Added: ",highlightRemovedLabel:"Removed: ",containerClass:"asmContainer",selectClass:"asmSelect",optionDisabledClass:"asmOptionDisabled",listClass:"asmList",listSortableClass:"asmListSortable",listItemClass:"asmListItem",listItemLabelClass:"asmListItemLabel",removeClass:"asmListItemRemove",highlightClass:"asmHighlight"};a.extend(c,b);return this.each(function(l){var z=a(this);var s;var w;var n;var o=false;var e=false;var h=false;function u(){while(a("#"+c.containerClass+l).size()>0){l++}w=a("<select></select>").addClass(c.selectClass).attr("name",c.selectClass+l).attr("id",c.selectClass+l);$selectRemoved=a("<select></select>");n=a("<"+c.listType+"></"+c.listType+">").addClass(c.listClass).attr("id",c.listClass+l);s=a("<div></div>").addClass(c.containerClass).attr("id",c.containerClass+l);v();w.change(m).click(A);z.change(q).wrap(s).before(w).before(n);if(c.sortable){x()}if(a.browser.msie&&a.browser.version<8){n.css("display","inline-block")}}function x(){n.sortable({items:"li."+c.listItemClass,handle:"."+c.listItemLabelClass,axis:"y",update:function(D,C){var B;a(this).children("li").each(function(E){$option=a("#"+a(this).attr("rel"));if(a(this).is(".ui-sortable-helper")){B=$option.attr("id");return}z.append($option)});if(B){t(B,"sort")}}}).addClass(c.listSortableClass)}function m(B){if(a.browser.msie&&a.browser.version<7&&!e){return}var C=a(this).children("option:selected").slice(0,1).attr("rel");r(C);e=false;t(C,"add")}function A(){e=true}function q(B){if(h){h=false;return}w.empty();n.empty();v();if(a.browser.opera){n.hide().fadeIn("fast")}}function v(){o=true;w.prepend("<option value=''>"+z.attr("title")+"</option>");z.children("option").each(function(D){var C=a(this);var B;if(!C.attr("id")){C.attr("id","asm"+l+"option"+D)}B=C.attr("id");if(C.is(":selected")){r(B);i(B,true)}else{i(B)}});if(!c.debugMode){z.hide()}g();o=false}function i(D,C){if(C==undefined){var C=false}var B=a("#"+D);var E=a("<option>"+B.html()+"</option>").val(B.val()).attr("rel",D);if(C){p(E)}w.append(E)}function g(){w.children(":eq(0)").attr("selected",true)}function p(B){B.addClass(c.optionDisabledClass).attr("selected",false).attr("disabled",true);if(c.hideWhenAdded){B.hide()}if(a.browser.msie){w.hide().show()}}function f(B){B.removeClass(c.optionDisabledClass).attr("disabled",false);if(c.hideWhenAdded){B.show()}if(a.browser.msie){w.hide().show()}}function r(E){var D=a("#"+E);if(!D){return}var F=a("<a></a>").attr("href","#").addClass(c.removeClass).prepend(c.removeLabel).click(function(){k(a(this).parent("li").attr("rel"));return false});var C=a("<span></span>").addClass(c.listItemLabelClass).html(D.html());var B=a("<li></li>").attr("rel",E).addClass(c.listItemClass).append(C).append(F).hide();if(!o){if(D.is(":selected")){return}D.attr("selected",true)}if(c.addItemTarget=="top"&&!o){n.prepend(B);if(c.sortable){z.prepend(D)}}else{n.append(B);if(c.sortable){z.append(D)}}d(B);p(a("[rel="+E+"]",w));if(!o){y(B,c.highlightAddedLabel);g();if(c.sortable){n.sortable("refresh")}}}function d(B){if(c.animate&&!o){B.animate({opacity:"show",height:"show"},100,"swing",function(){B.animate({height:"+=2px"},50,"swing",function(){B.animate({height:"-=2px"},25,"swing")})})}else{B.show()}}function k(D,B){if(B==undefined){var B=true}var C=a("#"+D);C.attr("selected",false);$item=n.children("li[rel="+D+"]");j($item);f(a("[rel="+D+"]",c.removeWhenAdded?$selectRemoved:w));if(B){y($item,c.highlightRemovedLabel)}t(D,"drop")}function j(B){if(c.animate&&!o){$prevItem=B.prev("li");B.animate({opacity:"hide",height:"hide"},100,"linear",function(){$prevItem.animate({height:"-=2px"},50,"swing",function(){$prevItem.animate({height:"+=2px"},100,"swing")});B.remove()})}else{B.remove()}}function y(B,C){if(!c.highlight){return}w.next("#"+c.highlightClass+l).remove();var D=a("<span></span>").hide().addClass(c.highlightClass).attr("id",c.highlightClass+l).html(C+B.children("."+c.listItemLabelClass).slice(0,1).text());w.after(D);D.fadeIn("fast",function(){setTimeout(function(){D.fadeOut("slow")},50)})}function t(C,B){h=true;$option=a("#"+C);z.trigger("change",[{option:$option,value:$option.val(),id:C,item:n.children("[rel="+C+"]"),type:B}])}u()})}})(jQuery);